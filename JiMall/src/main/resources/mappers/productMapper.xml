<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jimall.mappers.ProductMapper">

	<!-- 1차 카테고리 출력 -->
	<select id="mainCateList" resultType="CategoryVO">
		select cate_thcode, cate_pracode, cate_name 
		from category_tbl
		where cate_pracode is null
	</select>

	<!-- 1차 카테고리에 따른 2차카테고리 출력 -->
	<select id="subCateList" parameterType="string" resultType="CategoryVO">
		select cate_thcode, cate_pracode, cate_name
		from category_tbl
		where cate_pracode = #{cate_pracode}	
	</select>
	
	<!-- 카테고리 코드에 해당하는 카테고리 명 -->
	<select id="getCateName" resultType="string">
		select cate_name from category_tbl
		where cate_thcode=#{cate_thcode}
	</select>
	
	<!-- 상품 리스트 -->
	<select id="productListCate" resultType="ProductVO">
		select prod_num, cate_thcode, prod_name, prod_price, prod_discount, 
		       prod_develop, prod_detailint, prod_img, prod_cominven, prod_buypos,
		       prod_regisdate, prod_updateDate
		from  (select prod_num, cate_thcode, prod_name, prod_price, prod_discount,
		       prod_develop, prod_detailint, prod_img, prod_cominven, prod_buypos,
		       prod_regisdate, prod_updateDate, row_number() over(order by prod_num desc) p_seq
		       from productinfo_tbl
		       where cate_thcode in (select cate_thcode from category_tbl where cate_pracode=#{cate_thcode}))
		where p_seq between #{rowStart} and #{rowEnd}           		
	</select>
	
	<!-- 카테고리 상품 개수 -->
	<select id="productCount" resultType="int">
		select count(prod_num) from productinfo_tbl
		where cate_thcode = #{cate_thcode}
 	</select>
 	
 	<select id="productListCri" resultType="ProductVO">
 		select prod_num, cate_thcode, prod_name, prod_price, prod_discount, 
		       prod_develop, prod_detailint, prod_img, prod_cominven, prod_buypos,
		       prod_regisdate, prod_updateDate
		from  (select prod_num, cate_thcode, prod_name, prod_price, prod_discount,
		       prod_develop, prod_detailint, prod_img, prod_cominven, prod_buypos,
		       prod_regisdate, prod_updateDate, row_number() over(order by prod_num desc) p_seq
		       from productinfo_tbl
		       where (prod_name like '%' || #{keyword} || '%')
		       	  or (prod_detailint like '%' || #{keyword} || '%')
		       )
		where p_seq between #{rowStart} and #{rowEnd} 
 	</select>
 	
 	<!-- 검색조건에 해당한느 상품 개수 -->
 	<select id="productCriCount">
 		select count(prod_num)
 		from productinfo_tbl
 		where (prod_name like '%' || #{keyword} || '%')
       	   or (prod_detailint like '%' || #{keyword} || '%')
 	</select>
 	
 	<!-- 상품 상세정보 -->
 	<select id="readProduct" resultType="ProductVO">
 		select prod_num, cate_thcode, prod_name, prod_price, prod_discount,
 			   prod_develop, prod_detailint, prod_img, prod_cominven, prod_buypos,
 			   prod_regisdate, prod_updateDate
	    from productinfo_tbl
	    where prod_num = #{prod_num}
 			   
 	</select>
</mapper>